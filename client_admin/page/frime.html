<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>留学生报名网站管理系统</title>
    <link rel="stylesheet" href="../layui/css/layui.css">
    <link rel="stylesheet" href="../css/diy.css">
    <style>
        /* 可选：美化顶部用户名 */
        .header-user {
            height: 60px;
            line-height: 60px;
            text-align: center;
            color: #fff;
        }
    </style>
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <!-- 顶部 -->
    <div class="layui-header">
        <div class="layui-logo layui-bg-black">
            <a href="./Home.html" target="main_self_frame" style="color: #fff;">
                <i class="layui-icon layui-icon-home"></i> 主页
            </a>
        </div>

        <ul class="layui-nav layui-layout-left">
            <li class="layui-nav-item layui-hide-xs">
                <h2 style="color:#fff;margin:0;padding-left:20px;">留学生报名网站管理系统</h2>
            </li>
        </ul>

        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item">
                <a href="javascript:;" id="websiteHomePage">网站首页</a>
            </li>
            <li class="layui-nav-item">
                <a href="javascript:;">
                    <span id="username">加载中...</span>
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="./info.html" target="main_self_frame">个人资料</a></dd>
                    <dd><a href="./change_password.html" target="main_self_frame">修改密码</a></dd>
                    <dd><a href="javascript:;" id="logout">退出登录</a></dd>
                </dl>
            </li>
        </ul>
    </div>

    <!-- 左侧菜单 -->
    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <ul class="layui-nav layui-nav-tree" id="sideMenu">
                <!-- 动态生成菜单将插入这里 -->
            </ul>
        </div>
    </div>

    <!-- 主内容区 -->
    <div class="layui-body">
        <iframe name="main_self_frame" id="mainFrame" src="./Home.html"
                frameborder="0" style="width:100%;height:100%;"></iframe>
    </div>
</div>

<script src="../layui/layui.js"></script>
<script src="../js/axios.min.js"></script>
<script src="../js/base.js"></script>
<script>
    const BaseUrl = baseUrl();
    axios.defaults.baseURL = BaseUrl;

    // 统一错误处理（可选保留）
    axios.interceptors.response.use(
        res => res.data,
        err => console.error('API错误（已忽略）:', err)
    );

    layui.use(['element', 'layer'], function() {
        const element = layui.element;
        const layer = layui.layer;

        let personInfo = {};
        try {
            personInfo = JSON.parse(sessionStorage.getItem('personInfo') || '{}');
        } catch (e) {
            location.href = '../index.html';
            return;
        }

        // 顶部用户名
        document.getElementById('username').textContent = personInfo.username || 'admin';

        const menu = document.getElementById('sideMenu');

        // 个人资料（始终显示）
        menu.innerHTML += `
            <li class="layui-nav-item layui-nav-itemed">
                <a href="javascript:;"><i class="layui-icon layui-icon-username"></i> 个人中心</a>
                <dl class="layui-nav-child">
                    <dd><a href="./info.html" target="main_self_frame">个人信息</a></dd>
                    <dd><a href="./change_password.html" target="main_self_frame">修改密码</a></dd>
                </dl>
            </li>
        `;

        // === 所有管理模块（分组更清晰）===
        const modules = [
            // 公共管理
            { icon: 'layui-icon-carousel', title: '轮播图管理', path: './slides/table.html' },
            { icon: 'layui-icon-speaker', title: '公告信息管理', path: './notice/table.html' },

            // 用户管理
            { icon: 'layui-icon-user', title: '管理员管理', path: './user/table.html' },
            { icon: 'layui-icon-group', title: '学生用户管理', path: './student_users/table.html' },

            // 内容管理
            { icon: 'layui-icon-note', title: '文章管理', path: './article/table.html' },
            { icon: 'layui-icon-tabs', title: '文章分类管理', path: './article_type/table.html' },

            // 留学生核心业务
            { icon: 'layui-icon-read', title: '申请指南管理', path: './application_guide/table.html' },
            { icon: 'layui-icon-console', title: '专业信息管理', path: './professional_information/table.html' },
            { icon: 'layui-icon-form', title: '留学申报管理', path: './application_for_studying_abroad/table.html' },
            { icon: 'layui-icon-dollar', title: '学费缴纳管理', path: './tuition_payment/table.html' },
            { icon: 'layui-icon-friends', title: '留学生管理', path: './international_student_management/table.html' }
        ];

        // 可加分组标题（美观）
        menu.innerHTML += `<li class="layui-nav-item layui-nav-title"><a>系统管理</a></li>`;
        modules.forEach(mod => {
            menu.innerHTML += `
                <li class="layui-nav-item">
                    <a href="${mod.path}" target="main_self_frame">
                        <i class="${mod.icon}"></i> ${mod.title}
                    </a>
                </li>
            `;
        });

        element.render('nav');

        // 退出登录
        document.getElementById('logout').onclick = async () => {
            try { await axios.get('/api/user/quit'); } catch (e) {}
            sessionStorage.clear();
            location.href = '../index.html';
        };

        // 网站首页
        document.getElementById('websiteHomePage').onclick = () => {
            const token = sessionStorage.getItem('token');
            location.href = token ? `http://localhost:8081/?token=${token}` : 'http://localhost:8081/';
        };
    });
</script>
</body>
</html>
