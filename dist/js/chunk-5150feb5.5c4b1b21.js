(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5150feb5"],{"16d8":function(t,e,r){},"5dc0":function(t,e,r){"use strict";r.r(e);var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"page_account",attrs:{id:"account_register"}},[e("div",{staticClass:"warp"},[e("div",{staticClass:"container"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-md-6"},[e("div",{staticClass:"card"},[e("div",{staticClass:"form_register"},[e("b-form",[e("b-form-group",{attrs:{id:"input-group-1",label:"账号:","label-for":"input-1"}},[e("b-form-input",{attrs:{id:"input-1",type:"text",placeholder:"账号",trim:""},model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}})],1),e("b-form-group",{attrs:{id:"input-group-2",label:"设置密码:","label-for":"input-2"}},[e("b-form-input",{attrs:{id:"input-2",type:"password",placeholder:"5个字符到16个字符",trim:""},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),e("b-form-group",{attrs:{id:"input-group-3",label:"确认密码:","label-for":"input-3"}},[e("b-form-input",{attrs:{id:"input-3",type:"password",placeholder:"确认密码",trim:""},model:{value:t.confirm_password,callback:function(e){t.confirm_password=e},expression:"confirm_password"}})],1),e("b-form-group",{attrs:{id:"input-group-4",label:"昵称:","label-for":"input-4"}},[e("b-form-input",{attrs:{id:"input-4",type:"text",placeholder:"2个字符到12个字符",trim:""},model:{value:t.form.nickname,callback:function(e){t.$set(t.form,"nickname",e)},expression:"form.nickname"}})],1),e("b-form-group",{attrs:{id:"input-group-5",label:"邮箱:","label-for":"input-5"}},[e("b-form-input",{attrs:{id:"input-5",type:"email",placeholder:"例: example@123.com",trim:""},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})],1),e("b-form-group",{attrs:{id:"input-group-6",label:"手机号:","label-for":"input-6"}},[e("b-form-input",{attrs:{id:"input-6",type:"text",placeholder:"例: 18955552312",trim:""},model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1),e("b-form-group",{attrs:{id:"input-group-7",label:"身份:","label-for":"input-7"}},[e("b-form-select",{attrs:{id:"user_group",options:t.list_user_group,placeholder:"请选择身份"},model:{value:t.form.user_group,callback:function(e){t.$set(t.form,"user_group",e)},expression:"form.user_group"}})],1),"学生用户"===t.form.user_group?e("form_student_users",{attrs:{form:t.form_sub}}):t._e(),e("div",{staticClass:"btns_bottom"},[e("div",{staticClass:"btn_item",on:{click:function(e){return t.submit()}}},[t._v("注册")]),e("div",{staticClass:"forgot_nav",on:{click:function(e){return t.$router.push("/account/forgot")}}},[t._v(" 忘记密码 ")])])],1)],1)])]),e("div",{staticClass:"col-12 col-md-6"},[e("div",{staticClass:"card"},[e("div",{staticClass:"register_nav identify_choose"},[e("div",{staticStyle:{"text-align":"center","margin-bottom":"20px"}},[t._v(" 已有账户? ")]),e("div",{staticClass:"btn_item",on:{click:function(e){return t.$router.push("/account/login")}}},[t._v("登录")])])])])])])])])},o=[],i=r("c6e7"),a=function(){var t=this,e=t._self._c;return e("div",[t.$check_register_field("add","student_name","/student_users/view")?e("b-form-group",{attrs:{id:"input-group-${idx}",label:"学生姓名","label-for":"input-${idx}"}},[e("b-form-input",{attrs:{id:"input-${idx}",type:"text",placeholder:"学生姓名",trim:""},model:{value:t.form["student_name"],callback:function(e){t.$set(t.form,"student_name",e)},expression:"form['student_name']"}})],1):t._e(),t.$check_register_field("add","student_gender","/student_users/view")?e("b-form-group",{attrs:{id:"input-group-${idx}",label:"学生性别","label-for":"input-${idx}"}},[e("b-form-select",{attrs:{id:"input-${idx}",options:t.getDropList(t.list_student_gender)},model:{value:t.form["student_gender"],callback:function(e){t.$set(t.form,"student_gender",e)},expression:"form['student_gender']"}})],1):t._e(),t.$check_register_field("add","student_nationality","/student_users/view")?e("b-form-group",{attrs:{id:"input-group-${idx}",label:"学生国籍","label-for":"input-${idx}"}},[e("b-form-input",{attrs:{id:"input-${idx}",type:"text",placeholder:"学生国籍",trim:""},model:{value:t.form["student_nationality"],callback:function(e){t.$set(t.form,"student_nationality",e)},expression:"form['student_nationality']"}})],1):t._e()],1)},u=[],n=r("6265"),l={mixins:[n["a"]],model:{prop:"form",event:"change"},props:{form:{type:Object,default:()=>({})}},data(){return{url_upload:"~/api/student_users/upload?",list_student_gender:"男,女"}},methods:{getDropList(t){let e=[];if(t){let r=t.split(",");r.forEach(t=>{e.push({value:t,text:t})})}return e},uploadFile(t,e="img"){var r=this,s=new FormData;s.append("file",t[0]),this.$upload(this.url_upload,s,(function(t){t.result?(r.$delete(r.form,e),r.$set(r.form,e,t.result.url),console.log(r.form[e])):r.$toast("上传失败！")}))}},created(){},mounted(){}},p=l,m=r("0b56"),d=Object(m["a"])(p,a,u,!1,null,null,null),c=d.exports,f={components:{form_student_users:c},mixins:[i["a"]],data(){return{url_submit:"~/api/user/register?",form:{username:"",password:"",nickname:"",email:"",phone:"",user_group:""},confirm_password:"",form_sub:{},list_user_group:[{value:"买家",text:"买家"},{value:"商家",text:"商家"}],user_group:[]}},methods:{get_list_user_group(){this.$get("~/api/user_group/get_list?register_max=3&register_min=2",{},t=>{if(t.result.list){var e=[],r=t.result.list;r.map(t=>{e.push({value:t.name,text:t.name})}),this.list_user_group=e,this.user_group=r}else t.error&&(console.error(t.error),this.$toast(t.error.message,"error"))})},async submit(t,e){t||(t=this.form);var r,s=this.events("submit_before",Object.assign({},t))||t,o=await this.events("submit_check",s);return console.log("提交前错误信息msg：",o),o?this.$toast(o,"danger"):r=this.events("submit_main",s,e),r},submit_before(t){t.user_group},async submit_check(t){var e=null,r=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,s=/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/,{username:o,password:i,nickname:a,user_group:u,email:n,phone:l}=t,p=this.confirm_password;if(console.log("表单校验username ,password ,email ,nickname ,user_group",o,i,n,a,u),o?o.length>16||o.length<5?e="账号长度应为5到16个字符之间！":i?i.length>16||i.length<5?e="密码长度应为5到16个字符之间！":a&&a.length>12||a.length<2?e="昵称长度应为2个字符到12个字符之间":n&&!r.test(n)?e="请输入正确的邮箱地址 例：test@test.com!":l&&!s.test(l)?e="请输入正确的手机号码 例：18955552312!":i!=p?e="确认密码与密码不一致！":u||(e="请选择用户组!"):e="密码不能为空!":e="账号不能为空",!e&&u&&"学生用户"===u)Object.assign({},this.form_sub);var m={username:t.username};if(!e){var d=await this.$get("~/api/user/count?",m);d.result&&(e="用户已存在!")}return e},submit_after(t,e){var r=Object.assign({},this.form);delete r.password,console.log("查询表单form",r);var s=this.user_group.getVal("source_table",{name:r.user_group});console.log("关联表:",s),s?this.get_submit(r,s):console.log("用户组没有关联表")},get_submit(t,e){var r=this.form_sub;this.$get("~/api/user/get_obj?",t,t=>{console.log("注册表信息res",t),t.result&&t.result.obj?(r.user_id=t.result.obj.user_id,this.submit_sub(r,e)):t.error&&(console.error(t.error),this.$toast(t.error.message,"error"))})},submit_sub(t,e){this.$post("~/api/"+e+"/add?",t,t=>{console.log("提交结果res：",t),t.result?(this.$toast("注册成功!"),this.$router.push("/")):t.error&&(console.error(t.error),this.$toast(t.error.message))})}},created(){this.get_list_user_group()}},_=f,g=(r("98b4"),Object(m["a"])(_,s,o,!1,null,"4cf4963b",null));e["default"]=g.exports},"98b4":function(t,e,r){"use strict";r("16d8")}}]);
//# sourceMappingURL=chunk-5150feb5.5c4b1b21.js.map